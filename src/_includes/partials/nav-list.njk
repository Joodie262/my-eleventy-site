<div class="nav">
  <button class="nav-toggle" aria-expanded="false" aria-controls="site-menu">
    â˜° Menu
  </button>

  <div id="site-menu" class="nav-links">
    {% set navPages = collections.all | eleventyNavigation %}

    {% macro renderNavItem(item) %}
      {% if item.children.length %}
        <details class="nav-item"{% if item.isActive %} open{% endif %}>
          <summary>
            <button class="nav-toggle-child" aria-label="Toggle submenu"
              onclick="this.closest('details').open = !this.closest('details').open; event.stopPropagation();"></button>
            <a href="{{ item.url | url }}"
               class="nav-parent-link"
               {% if item.isCurrent %}aria-current="page"{% endif %}>
              {{ item.title }}
            </a>
          </summary>
          {% set kids = item.children %}
          <ul class="dropdown">
            {%- for child in kids -%}
              <li>
                <a href="{{ child.url | url }}"{% if child.isCurrent %} aria-current="page"{% endif %}>
                  {{ child.title }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </details>
      {% else %}
        <a href="{{ item.url | url }}"{% if item.isCurrent %} aria-current="page"{% endif %}>
          {{ item.title }}
        </a>
      {% endif %}
    {% endmacro %}

    {% set printedCount = 0 %}
    {% for entry in navPages %}
      {% set willRender = entry.title and (entry.url or entry.children.length) %}
      {% if willRender %}
        {% if printedCount > 0 %}
          <span class="nav-sep">|</span>
        {% endif %}
        {{ renderNavItem(entry) }}
        {% set printedCount = printedCount + 1 %}
      {% endif %}
    {% endfor %}
  </div>
</div>
